## TIMELINE-001 to TIMELINE-004: at() + runTimeline() infrastructure

Completed: types.ts interface + script-runner.ts implementation

Key decisions:
- at(time, fn) just pushes to timeline array, no validation
- runTimeline() re-sorts each iteration for dynamic scheduling support
- waitTime computed as entry.time - getElapsedTime(), skipped if <= 0
- fn awaited to support async callbacks

Files:
- src/server/encounters/types.ts: added at(), runTimeline() to ScriptRunner interface
- src/server/encounters/script-runner.ts: added timeline array, at(), runTimeline() methods

Build passes. Sub-script isolation via run() already works - new ScriptRunnerImpl gets empty timeline by default.

## TIMELINE-005: Dynamic scheduling test

Verified via Playwright E2E test.

Test script: schedules fn1@T=0, fn2@T=2000. fn1 dynamically schedules fn3@T=1000.
Expected order: fn1 -> fn3 -> fn2. Confirmed via mechanic spawn positions:
- T=24ms: chariot at (160,160) = fn1 (top-left)
- T=1027ms: chariot at (400,400) = fn3 (center, dynamically scheduled)
- T=2028ms: chariot at (640,640) = fn2 (bottom-right)

Files:
- src/server/encounters/scripts/tests/dynamic-scheduling-test.ts (new)
- src/server/index.ts: added admin:runDynamicSchedulingTest handler
- src/client/admin.ts: added emitRunDynamicSchedulingTest()

## TIMELINE-006: Sub-script timeline isolation

Verified via Playwright E2E test.

Test: parent schedules fn_parent1@T=0, fn_parent2@T=2000. fn_parent1 calls run(subScript).
subScript schedules fn_sub@T=500 and calls runTimeline().

Expected: sub-script has isolated timeline, fn_sub executes at parent T=500, fn_parent2 at T=2000.
Confirmed via mechanic spawn positions:
- T=11ms: chariot at (160,160) = fn_parent1
- T=513ms: chariot at (400,400) = fn_sub (sub-script isolated, T=500 relative to sub-script start)
- T=2015ms: chariot at (640,640) = fn_parent2

run() creates new ScriptRunnerImpl → fresh empty timeline array → isolation automatic.

Files:
- src/server/encounters/scripts/tests/subscript-timeline-isolation-test.ts (new)
- src/server/index.ts: added admin:runSubscriptTimelineIsolationTest handler
- src/client/admin.ts: added emitRunSubscriptTimelineIsolationTest()

## TIMELINE-007: Migrate quad-knock.ts to at() + runTimeline()

Replaced sequential wait() calls with declarative at() scheduling.

Changes:
- Moved player ID arrays outside at() callbacks for cross-callback access
- runner.at(0, fn) for first pair spawn
- runner.at(SECOND_PAIR_SPAWN, fn) for second pair spawn
- runner.at(WARNING_START, fn) for warning statuses
- runner.at(WARNING_START + WARNING_DURATION, fn) for final status conversion
- await runner.runTimeline() executes timeline
- Final wait(FINAL_STATUS_DURATION) for cleanup

E2E verification (Playwright):
- T=57ms: first pair spawned (expected T=0)
- T=2057ms: second pair spawned (expected T=2000)
- T=4057ms: warning status applied (expected T=4000)
- T=9023ms: final status applied (expected T=9000)
- T=9523ms: first knockbacks triggered (expected T=9500)
- T=11022ms: second knockbacks triggered (expected T=11000)
- T=12539ms: statuses expired (expected T=12500)

All timings within ~60ms tolerance. Script behavior unchanged.

Files:
- src/server/encounters/scripts/combos/quad-knock.ts: migrated to at() + runTimeline()

## TIMELINE-008: E2E verification of quad-knock migration

Full E2E test via Playwright confirms timing matches pre-migration behavior.

Test results:
- First pair spawn: T=20ms (expected T=0) ✓
- Second pair spawn: T=2024ms (expected T=2000) ✓
- Warning status: T=4031ms (expected T=4000) ✓
- Final status: T=9039ms (expected T=9000) ✓
- First knockbacks: T=9539ms (expected T=9500) ✓
- Second knockbacks: T=11040ms (expected T=11000) ✓
- Status expiry: T=12545ms (expected T=12500) ✓

All timings within ~50ms tolerance. Matches TIMELINE-007 baseline.
