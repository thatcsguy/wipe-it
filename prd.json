{
    "name": "Status Effects & Spread AOEs",
    "items": [
        {
            "id": "HEAL-001",
            "category": "Admin Heal All Button",
            "description": "Add heal button HTML to admin panel. Add `<button id=\"heal-all-btn\">Heal All</button>` after the spawn button in public/index.html.",
            "stepsToVerify": [
                "Open public/index.html and verify a button with id 'heal-all-btn' and text 'Heal All' exists",
                "Use Playwright to navigate to localhost:3000, verify button is visible in admin panel"
            ],
            "passes": false
        },
        {
            "id": "HEAL-002",
            "category": "Admin Heal All Button",
            "description": "Add client click handler in src/client/admin.ts that emits 'admin:healAll' socket event when heal button is clicked.",
            "stepsToVerify": [
                "Read src/client/admin.ts and verify it adds click listener to 'heal-all-btn'",
                "Verify the click handler emits socket event 'admin:healAll'"
            ],
            "passes": false
        },
        {
            "id": "HEAL-003",
            "category": "Admin Heal All Button",
            "description": "Add server handler for 'admin:healAll' event. In src/server/index.ts listen for 'admin:healAll' and call game.healAllPlayers(). In src/server/game.ts add healAllPlayers() method that sets all players to MAX_HP.",
            "stepsToVerify": [
                "Read src/server/index.ts and verify it listens for 'admin:healAll' event",
                "Read src/server/game.ts and verify healAllPlayers() method exists and sets all player hp to MAX_HP",
                "Use Playwright: join game, take damage (if possible), click Heal All button, verify player health restored"
            ],
            "passes": false
        },
        {
            "id": "STATUS-001",
            "category": "Status Effect System",
            "description": "Define status effect types in src/shared/types.ts. Add StatusEffectType union starting with 'vulnerability'. Add StatusEffectState interface with type, iconPath, startTime, duration, playerId. Add statusEffects: StatusEffectState[] to PlayerState. Add statusEffects: StatusEffectState[] to GameState. Add Effect type variant for status effects: { type: 'status', statusType, duration }.",
            "stepsToVerify": [
                "Read src/shared/types.ts and verify StatusEffectType type exists with 'vulnerability'",
                "Verify StatusEffectState interface has: type, iconPath, startTime, duration, playerId",
                "Verify PlayerState has statusEffects array",
                "Verify GameState has statusEffects array",
                "Verify Effect type includes status variant with statusType and duration"
            ],
            "passes": true
        },
        {
            "id": "STATUS-002",
            "category": "Status Effect System",
            "description": "Create StatusEffect class in src/server/statusEffect.ts. Properties: type, playerId, startTime, duration, ongoingEffects, expirationEffects. Methods: tick(player) applies ongoing effects, isExpired(now) checks duration, onExpire(player) applies expiration effects, toState() serializes for client.",
            "stepsToVerify": [
                "Verify src/server/statusEffect.ts exists",
                "Verify StatusEffect class has properties: type, playerId, startTime, duration, ongoingEffects, expirationEffects",
                "Verify tick() method exists and applies ongoing effects",
                "Verify isExpired() method checks if now >= startTime + duration",
                "Verify onExpire() method applies expiration effects",
                "Verify toState() returns StatusEffectState object"
            ],
            "passes": true
        },
        {
            "id": "STATUS-003",
            "category": "Status Effect System",
            "description": "Create StatusEffectManager in src/server/statusEffectManager.ts. Methods: add(status) adds new status, tick(now, players) iterates statuses applying ongoing and removing expired, getStates() returns array of serialized states, remove(id) removes specific status.",
            "stepsToVerify": [
                "Verify src/server/statusEffectManager.ts exists",
                "Verify add() method accepts and stores StatusEffect",
                "Verify tick() iterates statuses, calls tick on each, removes expired",
                "Verify getStates() returns StatusEffectState[]",
                "Verify remove() can remove status by id or criteria"
            ],
            "passes": true
        },
        {
            "id": "STATUS-004",
            "category": "Status Effect System",
            "description": "Integrate StatusEffectManager into Game class. Add statusEffectManager property to src/server/game.ts. Call statusEffectManager.tick() during game tick. Include statusEffectManager.getStates() in game state broadcast.",
            "stepsToVerify": [
                "Read src/server/game.ts and verify statusEffectManager property exists",
                "Verify game tick calls statusEffectManager.tick()",
                "Verify getState() or broadcast includes statusEffects from statusEffectManager.getStates()"
            ],
            "passes": false
        },
        {
            "id": "STATUS-005",
            "category": "Status Effect System",
            "description": "Implement vulnerability status behavior in src/server/player.ts. When player has vulnerability status, takeDamage() multiplies incoming damage by 10.",
            "stepsToVerify": [
                "Read src/server/player.ts",
                "Verify takeDamage() checks for vulnerability status",
                "Verify damage is multiplied by 10 when vulnerability is active"
            ],
            "passes": false
        },
        {
            "id": "STATUS-006",
            "category": "Status Effect System",
            "description": "Add client-side status effect rendering. Create src/client/statusEffects.ts with renderStatusEffects(ctx, player, statuses) that draws status icons centered on player. Call status renderer in src/client/renderer.ts drawPlayerAt() after drawing the player circle. Add vulnerability icon to public/images/ (simple skull or down-arrow shape).",
            "stepsToVerify": [
                "Verify src/client/statusEffects.ts exists with renderStatusEffects function",
                "Verify src/client/renderer.ts imports and calls renderStatusEffects",
                "Verify vulnerability icon exists in public/images/",
                "Use Playwright: apply vulnerability to player, verify icon renders above player"
            ],
            "passes": false
        },
        {
            "id": "SPREAD-001",
            "category": "Spread AOE Mechanic",
            "description": "Define spread mechanic types in src/shared/types.ts. Add 'spread' to MechanicType union. Add SpreadMechanicState interface with: type: 'spread', id, targetPlayerId, radius, startTime, endTime. Note: no x/y since position comes from player.",
            "stepsToVerify": [
                "Read src/shared/types.ts",
                "Verify MechanicType includes 'spread'",
                "Verify SpreadMechanicState interface exists with type, id, targetPlayerId, radius, startTime, endTime",
                "Verify SpreadMechanicState does NOT have x/y position fields"
            ],
            "passes": false
        },
        {
            "id": "SPREAD-002",
            "category": "Spread AOE Mechanic",
            "description": "Create SpreadMechanic class in src/server/mechanics/spread.ts. Properties: id, targetPlayerId, radius, startTime, endTime, effects. Methods: tick(now) is no-op since position comes from player, isExpired(now) returns now >= endTime, resolve(players, statusManager) gets target player position and damages all players within radius then applies vulnerability status (1000ms duration), toState() returns SpreadMechanicState with targetPlayerId.",
            "stepsToVerify": [
                "Verify src/server/mechanics/spread.ts exists",
                "Verify SpreadMechanic has properties: id, targetPlayerId, radius, startTime, endTime, effects",
                "Verify resolve() finds all players within radius of target player",
                "Verify resolve() applies damage to players in range",
                "Verify resolve() applies vulnerability status with 1000ms duration",
                "Verify toState() returns SpreadMechanicState with targetPlayerId"
            ],
            "passes": false
        },
        {
            "id": "SPREAD-003",
            "category": "Spread AOE Mechanic",
            "description": "Update MechanicManager in src/server/mechanics/manager.ts to pass statusEffectManager to resolve() calls so SpreadMechanic can apply status effects.",
            "stepsToVerify": [
                "Read src/server/mechanics/manager.ts",
                "Verify resolve() method receives or has access to statusEffectManager",
                "Verify statusEffectManager is passed when calling mechanic.resolve()"
            ],
            "passes": false
        },
        {
            "id": "SPREAD-004",
            "category": "Spread AOE Mechanic",
            "description": "Add spawnSpread method to Game class in src/server/game.ts. Method signature: spawnSpread(playerId, radius, duration, effects) creates a SpreadMechanic attached to the specified player.",
            "stepsToVerify": [
                "Read src/server/game.ts",
                "Verify spawnSpread() method exists",
                "Verify it accepts playerId, radius, duration, effects parameters",
                "Verify it creates and adds a SpreadMechanic to mechanicManager"
            ],
            "passes": false
        },
        {
            "id": "SPREAD-005",
            "category": "Spread AOE Mechanic",
            "description": "Add admin button to spawn spread mechanic. In public/index.html add <button id=\"spawn-spread-btn\">Spawn Spread</button>. In src/client/admin.ts emit 'admin:spawnMechanic' with type: 'spread' on click. In src/server/index.ts handle type === 'spread' by picking a random player and spawning spread on them.",
            "stepsToVerify": [
                "Verify public/index.html has button with id 'spawn-spread-btn'",
                "Verify src/client/admin.ts adds click handler emitting admin:spawnMechanic with type 'spread'",
                "Verify src/server/index.ts handles spread type in spawnMechanic handler",
                "Verify server picks random player when spawning spread",
                "Use Playwright: join game, click Spawn Spread, verify spread mechanic appears on a player"
            ],
            "passes": false
        },
        {
            "id": "SPREAD-006",
            "category": "Spread AOE Mechanic",
            "description": "Add client spread rendering in src/client/mechanics.ts. Add renderSpread() function that gets player position from game state and draws FFXIV-style pink/purple gradient circle. Use light pink/purple outer ring (rgba(255, 128, 255, 0.3)), radial gradient pink/purple fill, pulsing glow effect based on progress toward expiration, clearly defined edge border.",
            "stepsToVerify": [
                "Verify src/client/mechanics.ts has renderSpread() function",
                "Verify it retrieves target player position from game state using targetPlayerId",
                "Verify it draws a circle with pink/purple gradient fill",
                "Verify outer ring has light pink/purple color",
                "Verify pulsing/glow effect based on mechanic progress",
                "Use Playwright: spawn spread, take screenshot, verify pink/purple AOE circle renders on player"
            ],
            "passes": false
        }
    ]
}
