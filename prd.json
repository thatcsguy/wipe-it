{
  "name": "Hitpoints + Mechanics System",
  "items": [
    {
      "id": "HP-001",
      "category": "Hitpoints",
      "description": "Add MAX_HP constant (100) and hp field to PlayerState interface in shared/types.ts",
      "verify": [
        "Check src/shared/types.ts contains MAX_HP = 100 constant",
        "Check PlayerState interface includes hp: number field"
      ],
      "passes": true
    },
    {
      "id": "HP-002",
      "category": "Hitpoints",
      "description": "Add hp property to server Player class with initial value 100, add takeDamage(amount) method that clamps hp to minimum 0, update toState() to include hp",
      "verify": [
        "Check src/server/player.ts has hp = 100 property",
        "Check takeDamage method exists and clamps to 0",
        "Check toState() returns object with hp field"
      ],
      "passes": true
    },
    {
      "id": "HP-003",
      "category": "Hitpoints",
      "description": "Render health bar for each player - colored bar positioned above player circle, below name text. Bar should show current hp out of max hp with color indicating health level",
      "verify": [
        "Use playwright to navigate to localhost:3000",
        "Join the game with a test name",
        "Take a screenshot and verify health bar is visible above player circle but below name",
        "Health bar should be colored (green/yellow/red based on hp level)"
      ],
      "passes": true
    },
    {
      "id": "MECH-001",
      "category": "Mechanics System",
      "description": "Create mechanics type definitions in src/server/mechanics/types.ts with Effect interface (type: 'damage', amount: number) and BaseMechanic interface (id, tick, isExpired, resolve, toState methods)",
      "verify": [
        "Check src/server/mechanics/types.ts exists",
        "Check Effect interface has type and amount fields",
        "Check BaseMechanic interface has required methods: tick, isExpired, resolve, toState"
      ],
      "passes": true
    },
    {
      "id": "MECH-002",
      "category": "Mechanics System",
      "description": "Create MechanicManager class in src/server/mechanics/manager.ts with: mechanics Map, add() method to register mechanics, tick(now, players) to update all and resolve expired ones, getStates() to return array of MechanicState for broadcast",
      "verify": [
        "Check src/server/mechanics/manager.ts exists",
        "Check MechanicManager class has add, tick, and getStates methods",
        "Verify tick method calls resolve on expired mechanics and removes them"
      ],
      "passes": true
    },
    {
      "id": "MECH-003",
      "category": "Mechanics System",
      "description": "Add MechanicState interface to shared/types.ts with fields: id, type, startTime, endTime, x, y, radius. Update GameState interface to include mechanics: MechanicState[] array",
      "verify": [
        "Check src/shared/types.ts has MechanicState interface with all required fields",
        "Check GameState interface includes mechanics array field"
      ],
      "passes": true
    },
    {
      "id": "MECH-004",
      "category": "Mechanics System",
      "description": "Integrate MechanicManager into Game class: instantiate manager, call tick in game loop, include mechanics in state broadcast",
      "verify": [
        "Check src/server/game.ts creates MechanicManager instance",
        "Check tick loop calls mechanicManager.tick()",
        "Check broadcast includes mechanics from getStates()"
      ],
      "passes": true
    },
    {
      "id": "CHARIOT-001",
      "category": "Chariot Mechanic",
      "description": "Create ChariotMechanic class in src/server/mechanics/chariot.ts implementing BaseMechanic. Constructor takes x, y, radius, duration, effects[]. isExpired returns true when current time >= endTime. resolve() damages all players within radius using their takeDamage method",
      "verify": [
        "Check src/server/mechanics/chariot.ts exists",
        "Check ChariotMechanic implements BaseMechanic interface",
        "Check resolve method calculates distance from mechanic center to each player and applies damage if within radius"
      ],
      "passes": true
    },
    {
      "id": "CHARIOT-002",
      "category": "Chariot Mechanic",
      "description": "Add spawnChariot(x, y, radius, duration, effects) method to Game class that creates a ChariotMechanic and adds it to the manager",
      "verify": [
        "Check src/server/game.ts has spawnChariot method",
        "Check method creates ChariotMechanic with provided parameters",
        "Check method adds mechanic to mechanicManager"
      ],
      "passes": true
    },
    {
      "id": "RENDER-001",
      "category": "Client Rendering",
      "description": "Create src/client/mechanics.ts with renderMechanics(ctx, mechanics[], serverTime) function and renderChariot(ctx, mechanic, serverTime) function. Chariot renders as orange-yellow (#ff9f40) transparent circle with expanding inner circle showing progress toward resolution",
      "verify": [
        "Check src/client/mechanics.ts exists",
        "Check renderMechanics and renderChariot functions exist",
        "Check renderChariot uses orange-yellow color with transparency",
        "Check inner circle radius is calculated as progress * outerRadius where progress = (now - startTime) / (endTime - startTime)"
      ],
      "passes": true
    },
    {
      "id": "RENDER-002",
      "category": "Client Rendering",
      "description": "Integrate mechanic rendering into client game loop - pass mechanics array and server timestamp to renderer, render mechanics before players so they appear below",
      "verify": [
        "Check src/client/game.ts passes mechanics to render function",
        "Check src/client/renderer.ts calls renderMechanics before drawing players"
      ],
      "passes": true
    },
    {
      "id": "ADMIN-001",
      "category": "Admin Panel",
      "description": "Add admin panel HTML structure to index.html - div positioned to the right of game canvas containing heading and 'Spawn Chariot' button. Style with dark background",
      "verify": [
        "Use playwright to navigate to localhost:3000",
        "Take screenshot and verify admin panel is visible to the right of game canvas",
        "Verify 'Spawn Chariot' button is present in admin panel"
      ],
      "passes": true
    },
    {
      "id": "ADMIN-002",
      "category": "Admin Panel",
      "description": "Create src/client/admin.ts that attaches click handler to Spawn Chariot button. On click, emit 'admin:spawnMechanic' socket event with { type: 'chariot' }",
      "verify": [
        "Check src/client/admin.ts exists",
        "Check button click emits admin:spawnMechanic event with type chariot"
      ],
      "passes": false
    },
    {
      "id": "ADMIN-003",
      "category": "Admin Panel",
      "description": "Handle admin:spawnMechanic socket event on server in index.ts. For type 'chariot': spawn with random x,y (padded from edges), radius = ARENA_HEIGHT * 0.2, duration = 3000ms, effect = damage 25",
      "verify": [
        "Check src/server/index.ts handles admin:spawnMechanic event",
        "Check handler calls game.spawnChariot with correct test parameters"
      ],
      "passes": false
    },
    {
      "id": "E2E-001",
      "category": "End-to-End",
      "description": "Full integration test: spawn chariot via admin button, verify visual appears and expands, verify damage is applied when mechanic resolves",
      "verify": [
        "Use playwright to navigate to localhost:3000 and join game",
        "Click Spawn Chariot button in admin panel",
        "Take screenshot immediately - verify orange circle AOE is visible",
        "Wait 3 seconds for mechanic to resolve",
        "If player was inside AOE radius, verify health bar shows reduced hp (75/100)",
        "If player was outside AOE radius, verify health bar shows full hp (100/100)"
      ],
      "passes": false
    }
  ]
}
