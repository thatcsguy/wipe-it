[
  {
    "id": "FP-001",
    "category": "types",
    "description": "Add 'magic-orb' to DoodadType union in src/shared/types.ts",
    "steps_to_verify": [
      "Open src/shared/types.ts",
      "Find DoodadType union",
      "Verify 'magic-orb' is included in the union"
    ],
    "passes": true
  },
  {
    "id": "FP-002",
    "category": "types",
    "description": "Add '8x8-grid' to ArenaSkinId union in src/shared/types.ts",
    "steps_to_verify": [
      "Open src/shared/types.ts",
      "Find ArenaSkinId type",
      "Verify '8x8-grid' is included in the union"
    ],
    "passes": true
  },
  {
    "id": "FP-003",
    "category": "client",
    "description": "Create magic-orb doodad renderer at src/client/doodads/magic-orb.ts. Export renderMagicOrb(ctx, doodad, pos, serverTime). Render circle (~40px radius) with element-colored glow. Read element from doodad.data.element: 'wind'=#00ff88 (green), 'lightning'=#ffff00 (yellow), 'ice'=#00ccff (blue). Include soft pulsing glow effect using serverTime.",
    "steps_to_verify": [
      "File src/client/doodads/magic-orb.ts exists",
      "renderMagicOrb function is exported",
      "Function reads doodad.data.element for color",
      "Renders circular orb with glow",
      "Glow pulses using serverTime"
    ],
    "passes": true
  },
  {
    "id": "FP-004",
    "category": "client",
    "description": "Register magic-orb in src/client/doodads/index.ts switch statement. Import renderMagicOrb and add case 'magic-orb' calling renderMagicOrb(ctx, doodad, pos, serverTime).",
    "steps_to_verify": [
      "Open src/client/doodads/index.ts",
      "Verify import { renderMagicOrb } from './magic-orb'",
      "Verify case 'magic-orb': renderMagicOrb(ctx, doodad, pos, serverTime) in switch"
    ],
    "passes": true
  },
  {
    "id": "FP-005",
    "category": "client",
    "description": "Add render8x8GridSkin function in src/client/arenaSkins.ts. Use 100px intervals. Draw 7 vertical lines at x=100,200,300,400,500,600,700 and 7 horizontal lines at same y positions. Use same rgba(100,150,200,0.3) styling as 4x4-grid. Add case '8x8-grid' in renderArenaSkin switch.",
    "steps_to_verify": [
      "Open src/client/arenaSkins.ts",
      "Verify render8x8GridSkin function exists",
      "Verify 7 vertical and 7 horizontal lines at 100px intervals",
      "Verify case '8x8-grid' calls render8x8GridSkin"
    ],
    "passes": true
  },
  {
    "id": "FP-006",
    "category": "script",
    "description": "Create src/server/encounters/scripts/combos/fresh-puff.ts. Export freshPuff: Script. At start: call runner.setArenaSkin('8x8-grid'). Spawn 5 magic-orb doodads with long duration (15000ms+). Random pattern: cardinals [(400,200),(600,400),(400,600),(200,400)] OR intercardinals [(200,200),(600,200),(600,600),(200,600)] plus middle at (400,400).",
    "steps_to_verify": [
      "File src/server/encounters/scripts/combos/fresh-puff.ts exists",
      "freshPuff is exported as Script type",
      "runner.setArenaSkin('8x8-grid') called at start",
      "5 magic-orb doodads spawned via runner.spawnDoodad"
    ],
    "passes": true
  },
  {
    "id": "FP-007",
    "category": "script",
    "description": "fresh-puff orb element assignment: Outer 4 orbs are 2 lightning + 2 ice, alternating around circle (opposite orbs same element). Random which element starts. Middle orb is 50/50 random ice or wind. Elements set via doodad data.element field.",
    "steps_to_verify": [
      "Outer orbs alternate elements (ice-lightning-ice-lightning or vice versa)",
      "Opposite orbs (indices 0+2, 1+3) have same element",
      "Middle orb randomly assigned 'ice' or 'wind'",
      "All doodads have data: { element: 'ice'|'lightning'|'wind' }"
    ],
    "passes": true
  },
  {
    "id": "FP-008",
    "category": "script",
    "description": "fresh-puff tether phase: At T=3000ms, spawn tether from each outer orb to a player. Use point-to-player tether: endpointA={type:'point', x, y} at orb position, endpointB={type:'player', playerId}. requiredDistance=0 (always stretched visual). duration=5000ms. Each orb tethers to different player if 4 players, otherwise random assignment.",
    "steps_to_verify": [
      "4 tethers spawn at T=3s",
      "Tethers connect orb positions (points) to players",
      "requiredDistance is 0",
      "duration is 5000ms",
      "With 4 players: 1:1 assignment; with fewer: random distribution"
    ],
    "passes": true
  },
  {
    "id": "FP-009",
    "category": "script",
    "description": "fresh-puff orb movement: At T=8000ms when tethers resolve, move each outer orb 200px toward its tethered player. Use waitForResolve(tetherId) to get player position at resolve time. Calculate direction: atan2(playerY-orbY, playerX-orbX). Destination: orb + 200px in that direction. Use moveDoodad(orbId, destX, destY, 750). Store movement angle for AOE phase.",
    "steps_to_verify": [
      "After tether resolve, orbs move via moveDoodad()",
      "Movement is exactly 200px toward tethered player",
      "Movement duration is 750ms",
      "Movement angle stored per orb for later use"
    ],
    "passes": true
  },
  {
    "id": "FP-010",
    "category": "script",
    "description": "fresh-puff chariot spawn: At T=8250ms (250ms into orb movement), spawn chariot at each outer orb's destination position. Chariot params: x=destX, y=destY, radius=50, duration=500. On resolve via waitForResolve, deal 100 damage to each player in playersHit.",
    "steps_to_verify": [
      "4 chariots spawn at T=8.25s at orb destination positions",
      "Chariots have radius=50, duration=500",
      "Chariots resolve at T=8.75s (same time orbs stop)",
      "Players hit by chariot receive runner.damage(playerId, 100)"
    ],
    "passes": true
  },
  {
    "id": "FP-011",
    "category": "script",
    "description": "fresh-puff outer orb AOEs: At T=13750ms (5s after T=8750ms landing), ice orbs fire 4 lineAoe (width=200) at 0°,90°,180°,270° relative to movement angle. Lightning orbs fire 4 conalAoe (angle=Math.PI/6=30deg) at 45°,135°,225°,315° relative to movement angle. All AOEs: duration=500, deal 100 damage on resolve.",
    "steps_to_verify": [
      "Ice orbs: 4 lineAoe at cardinal directions from movement angle",
      "Lightning orbs: 4 conalAoe at intercardinal directions from movement angle",
      "Lines have width=200",
      "Cones have angle=Math.PI/6",
      "All AOEs duration=500, resolve with 100 damage"
    ],
    "passes": true
  },
  {
    "id": "FP-012",
    "category": "script",
    "description": "fresh-puff middle orb AOE: At T=13750ms, middle orb fires AOE based on element. If 'ice': 4 lineAoe at true N/S/E/W (vertical at x=400 spanning arena, horizontal at y=400 spanning arena), width=200, duration=500. If 'wind': dynamo at (400,400), innerRadius=100, outerRadius=600, duration=500. All deal 100 damage on resolve.",
    "steps_to_verify": [
      "Ice middle: 2 line AOEs (N-S vertical, E-W horizontal) from center",
      "Wind middle: dynamo at (400,400) with inner=100, outer=600",
      "AOE duration=500",
      "Players hit receive 100 damage"
    ],
    "passes": true
  },
  {
    "id": "FP-013",
    "category": "admin",
    "description": "Add 'Run Fresh Puff' button to debug panel. Button ID: #run-fresh-puff-btn. Add emitRunFreshPuff() to __adminTest object. Add socket.on('runFreshPuff') handler in server index.ts that calls runEncounter(game, freshPuff).",
    "steps_to_verify": [
      "Open localhost:3000?debug=1",
      "Button 'Run Fresh Puff' visible in admin panel",
      "Button has id='run-fresh-puff-btn'",
      "Clicking button or __adminTest.emitRunFreshPuff() starts encounter",
      "Server handles 'runFreshPuff' socket event"
    ],
    "passes": true
  },
  {
    "id": "FP-014",
    "category": "build",
    "description": "Project builds without TypeScript errors after all fresh-puff changes",
    "steps_to_verify": [
      "Run npm run build",
      "Verify no TypeScript compilation errors",
      "Verify build completes successfully"
    ],
    "passes": true
  },
  {
    "id": "FP-015",
    "category": "e2e",
    "description": "Full fresh-puff E2E validation: orb spawning, tether creation, orb movement, chariot damage, and AOE firing",
    "steps_to_verify": [
      "Navigate to localhost:3000?debug=1, join game",
      "Click 'Run Fresh Puff' button",
      "At T=0: verify 5 magic-orbs spawn (check .debug-mechanic or doodads)",
      "At T=3s: verify 4 tethers appear connecting orbs to players",
      "At T=8s: verify orbs start moving toward tethered players",
      "At T=8.25s: verify chariots appear at destination positions",
      "At T=8.75s: verify orbs stopped, chariots resolved, damage dealt if hit",
      "At T=13.75s: verify AOEs fire from all orbs",
      "At T=14.25s: verify AOEs resolved, damage dealt if hit"
    ],
    "passes": true
  }
]
