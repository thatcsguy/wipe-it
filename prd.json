{
  "feature": "Rooted Status Effect",
  "description": "New status effect that prevents player movement (WASD ignored) and grants knockback immunity. Uses FFXIV bind icon. Follows knockback pattern for input blocking on both client and server.",
  "items": [
    {
      "id": "ROOT-001",
      "category": "types",
      "description": "Add 'rooted' to StatusEffectType union in src/shared/types.ts.",
      "steps_to_verify": [
        "StatusEffectType includes 'rooted': export type StatusEffectType = 'vulnerability' | 'rooted'",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": true
    },
    {
      "id": "ROOT-002",
      "category": "asset",
      "description": "Download bind icon from https://ffxiv.consolegameswiki.com/mediawiki/images/8/89/Bind_icon1.png and save to public/assets/rooted_icon.png.",
      "steps_to_verify": [
        "File exists: public/assets/rooted_icon.png",
        "Image loads correctly when accessed via browser at localhost:3000/assets/rooted_icon.png"
      ],
      "passes": false
    },
    {
      "id": "ROOT-003",
      "category": "server",
      "description": "Add rooted icon path to STATUS_ICONS mapping in src/server/statusEffect.ts.",
      "steps_to_verify": [
        "STATUS_ICONS includes: rooted: '/assets/rooted_icon.png'",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": true
    },
    {
      "id": "ROOT-004",
      "category": "server",
      "description": "Add rooted movement block in Player.processInput() in src/server/player.ts. After knockback check, before WASD processing: if player has 'rooted' status, return early (skip WASD, freeze position).",
      "steps_to_verify": [
        "processInput() checks statusEffectManager.getStatusesForPlayer() for 'rooted' type",
        "If rooted, function returns early without applying WASD movement",
        "lastProcessedInput is still updated even when rooted (for reconciliation)",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": false
    },
    {
      "id": "ROOT-005",
      "category": "server",
      "description": "Add knockback immunity for rooted players in Player.applyKnockback() in src/server/player.ts. At start of method: if player has 'rooted' status, return early (immune to knockback).",
      "steps_to_verify": [
        "applyKnockback() checks statusEffectManager.getStatusesForPlayer() for 'rooted' type",
        "If rooted, function returns early without applying knockback",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": false
    },
    {
      "id": "ROOT-006",
      "category": "client",
      "description": "Create src/client/localStatus.ts module to track local player's status effects. Exports: setLocalPlayerId(id), updateLocalStatuses(statuses), isRooted() -> boolean.",
      "steps_to_verify": [
        "File exists: src/client/localStatus.ts",
        "Exports setLocalPlayerId(id: string): void",
        "Exports updateLocalStatuses(statuses: StatusEffectState[]): void - filters to local player",
        "Exports isRooted(): boolean - returns true if local player has 'rooted' status",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": false
    },
    {
      "id": "ROOT-007",
      "category": "client",
      "description": "Wire up local status tracking in src/client/game.ts. Import localStatus module. Call setLocalPlayerId() when player joins. Call updateLocalStatuses() in socket 'state' handler after finding local player.",
      "steps_to_verify": [
        "game.ts imports setLocalPlayerId and updateLocalStatuses from ./localStatus",
        "setLocalPlayerId(playerId) called in startGame() after join",
        "updateLocalStatuses(myPlayer.statusEffects) called in state handler",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": false
    },
    {
      "id": "ROOT-008",
      "category": "client",
      "description": "Add rooted input blocking in applyInput() in src/client/network.ts. After knockback check: if isRooted() returns true, return early (skip local input application).",
      "steps_to_verify": [
        "network.ts imports isRooted from ./localStatus",
        "applyInput() checks isRooted() after localKnockback check",
        "If rooted, function returns early without updating localX/localY or pendingInputs",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": false
    },
    {
      "id": "ROOT-009",
      "category": "client",
      "description": "Add rooted handling in reconcile() in src/client/network.ts. After knockback block: if isRooted(), use server position and skip input replay (similar to knockback handling).",
      "steps_to_verify": [
        "reconcile() checks isRooted() after knockback handling block",
        "If rooted, position is synced from server and input replay is skipped",
        "TypeScript compilation succeeds: npm run build"
      ],
      "passes": false
    },
    {
      "id": "ROOT-010",
      "category": "integration",
      "description": "Verify rooted status prevents movement. Apply rooted status to player, verify WASD inputs have no effect on position.",
      "steps_to_verify": [
        "Use Playwright: navigate to localhost:3000?debug=1",
        "Apply rooted status via browser evaluate: socket.emit('admin:testApplyStatus', { statusType: 'rooted', duration: 10000 }) or equivalent",
        "Record player position from .debug-player[data-x], [data-y]",
        "Send WASD keyboard inputs",
        "Verify position attributes unchanged while rooted",
        "Verify rooted icon displays on player (take screenshot)"
      ],
      "passes": false
    },
    {
      "id": "ROOT-011",
      "category": "integration",
      "description": "Verify rooted grants knockback immunity. Apply rooted status, trigger knockback, verify player position unchanged.",
      "steps_to_verify": [
        "Use Playwright: navigate to localhost:3000?debug=1",
        "Apply rooted status to player with 10s duration",
        "Record player position",
        "Spawn radial knockback at player position via __adminTest.emitSpawnRadialKnockback({ delay: 1000 })",
        "Wait for knockback to resolve (2s)",
        "Verify player position unchanged (knockback had no effect)"
      ],
      "passes": false
    },
    {
      "id": "ROOT-012",
      "category": "integration",
      "description": "Verify rooted status expires correctly and movement resumes. Apply short-duration rooted, wait for expiration, verify WASD works again.",
      "steps_to_verify": [
        "Use Playwright: navigate to localhost:3000?debug=1",
        "Apply rooted status with 2000ms duration",
        "Verify .debug-status[data-effect='rooted'] appears",
        "Wait 2500ms",
        "Verify .debug-status[data-effect='rooted'] removed",
        "Send WASD input, verify player position changes (movement restored)"
      ],
      "passes": false
    }
  ]
}
