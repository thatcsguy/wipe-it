{
  "feature": "Refactor client mechanics into per-mechanic files",
  "description": "Split src/client/mechanics.ts into a mechanics/ directory with individual files per mechanic type, matching the server-side organization pattern",
  "items": [
    {
      "id": "MECH-001",
      "category": "refactor",
      "description": "Create src/client/mechanics/shared.ts with common constants and helpers. Extract from src/client/mechanics.ts: all color constants (CHARIOT_COLOR, CHARIOT_FILL_ALPHA, CHARIOT_INNER_ALPHA, SPREAD_OUTER_COLOR, SPREAD_BORDER_COLOR, TETHER_UNSTRETCHED_COLOR, TETHER_STRETCHED_COLOR), the PlayerPositionData interface, getPlayerPosition() function, and getEndpointPosition() function. Export all of them.",
      "stepsToVerify": [
        "File src/client/mechanics/shared.ts exists",
        "File contains and exports all 7 color constants",
        "File exports PlayerPositionData interface",
        "File exports getPlayerPosition function",
        "File exports getEndpointPosition function",
        "Run: npm run build - compiles without errors"
      ],
      "passes": true
    },
    {
      "id": "MECH-002",
      "category": "refactor",
      "description": "Create src/client/mechanics/chariot.ts with renderChariot function. Import CHARIOT_COLOR, CHARIOT_FILL_ALPHA, CHARIOT_INNER_ALPHA from ./shared. Import ChariotMechanicState from '../../shared/types'. Export renderChariot(ctx: CanvasRenderingContext2D, mechanic: ChariotMechanicState, serverTime: number): void.",
      "stepsToVerify": [
        "File src/client/mechanics/chariot.ts exists",
        "File imports color constants from ./shared",
        "File imports ChariotMechanicState from ../../shared/types",
        "File exports renderChariot function",
        "Run: npm run build - compiles without errors"
      ],
      "passes": true
    },
    {
      "id": "MECH-003",
      "category": "refactor",
      "description": "Create src/client/mechanics/spread.ts with renderSpread function. Import SPREAD_OUTER_COLOR, SPREAD_BORDER_COLOR, PlayerPositionData, getPlayerPosition from ./shared. Import SpreadMechanicState from '../../shared/types'. Export renderSpread(ctx: CanvasRenderingContext2D, mechanic: SpreadMechanicState, serverTime: number, posData: PlayerPositionData): void.",
      "stepsToVerify": [
        "File src/client/mechanics/spread.ts exists",
        "File imports color constants and helpers from ./shared",
        "File imports SpreadMechanicState from ../../shared/types",
        "File exports renderSpread function",
        "Run: npm run build - compiles without errors"
      ],
      "passes": true
    },
    {
      "id": "MECH-004",
      "category": "refactor",
      "description": "Create src/client/mechanics/tether.ts with renderTether function. Import TETHER_UNSTRETCHED_COLOR, TETHER_STRETCHED_COLOR, PlayerPositionData, getEndpointPosition from ./shared. Import TetherMechanicState from '../../shared/types'. Export renderTether(ctx: CanvasRenderingContext2D, mechanic: TetherMechanicState, posData: PlayerPositionData): void.",
      "stepsToVerify": [
        "File src/client/mechanics/tether.ts exists",
        "File imports color constants and helpers from ./shared",
        "File imports TetherMechanicState from ../../shared/types",
        "File exports renderTether function",
        "Run: npm run build - compiles without errors"
      ],
      "passes": true
    },
    {
      "id": "MECH-005",
      "category": "refactor",
      "description": "Create src/client/mechanics/index.ts as the main entry point. Import render functions from ./chariot, ./spread, ./tether. Re-export PlayerPositionData from ./shared. Implement and export renderMechanics(ctx, mechanics, serverTime, posData?) that dispatches to appropriate render function based on mechanic.type. Attach __mechanicsTest to window with renderMechanics.",
      "stepsToVerify": [
        "File src/client/mechanics/index.ts exists",
        "File exports renderMechanics function",
        "File exports PlayerPositionData interface",
        "File attaches __mechanicsTest to window",
        "Run: npm run build - compiles without errors"
      ],
      "passes": true
    },
    {
      "id": "MECH-006",
      "category": "refactor",
      "description": "Update src/client/game.ts import path from './mechanics' to './mechanics/index' (or './mechanics' if TypeScript resolves index.ts). Ensure PlayerPositionData and renderMechanics are still imported correctly.",
      "stepsToVerify": [
        "src/client/game.ts imports renderMechanics and PlayerPositionData from mechanics directory",
        "Run: npm run build - compiles without errors"
      ],
      "passes": true
    },
    {
      "id": "MECH-007",
      "category": "cleanup",
      "description": "Delete the old src/client/mechanics.ts file after all code has been migrated to the new directory structure.",
      "stepsToVerify": [
        "File src/client/mechanics.ts does NOT exist",
        "Run: npm run build - compiles without errors"
      ],
      "passes": true
    },
    {
      "id": "MECH-008",
      "category": "integration",
      "description": "Verify chariot mechanic renders correctly in browser using Playwright.",
      "stepsToVerify": [
        "Start dev server: npm run dev",
        "Use Playwright browser_navigate to http://localhost:3000",
        "Use Playwright to type a name and click Join button",
        "Use Playwright to click #spawn-chariot-btn",
        "Use Playwright browser_snapshot to verify .debug-mechanic[data-type='chariot'] exists",
        "Wait 3 seconds, take another snapshot to verify mechanic resolved (element gone)"
      ],
      "passes": true
    },
    {
      "id": "MECH-009",
      "category": "integration",
      "description": "Verify spread mechanic renders correctly in browser using Playwright.",
      "stepsToVerify": [
        "With dev server running and player joined",
        "Use Playwright to click #spawn-spread-btn",
        "Use Playwright browser_snapshot to verify .debug-mechanic[data-type='spread'] exists",
        "Wait for mechanic to resolve, verify element gone"
      ],
      "passes": true
    }
  ]
}
